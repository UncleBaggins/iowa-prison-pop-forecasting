---
title: "Iowa Prison Population Growth Analysis"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(echarts4r)
library(dplyr)
library(janitor)
library(lubridate)
library(timetk)
library(shiny)
library(plotly)

load("./data/arima_with_seasonality_before_covid.rda")
# load("./data/all_data_forecast.rda")
# load("./data/all_data_forecast_offense_type.rda")
# load("./data/pre_covid_forecast.rda")
# load("./data/pre_covid_forecast_offense_type.rda")
monthly_prison_pop <- df_new
```

Dashboard {data-icon="ion-stats-bars"}
=====================================

Column {.sidebar data-width=250}
-----------------------------------------------------------------------

```{r}
offenseTypes <- monthly_prison_pop %>%
  select(offesnse_category) %>%
  distinct() #%>%
  # filter(!offesnse_category %in% c("None","No Charge", NA)) 

selectInput("offenseType", label = h4("Offense Type"), 
    choices = sort(offenseTypes$offesnse_category),
    multiple = TRUE)

numericInput("popAdjustPct", 
             label = h4("Population Adjustment Percent"), 
             value = 0)

```

Column {data-width=450, data-height=150}
-----------------------------------------------------------------------
### Current Prison Population

```{r}
currPop <- 10000

renderValueBox({
  valueBox(
    value = format(currPop, nsmall=0, big.mark=","),
    icon = "fa-users",
    color = "primary"
  )
})

# renderValueBox({
#   rate <- formatC(downloadRate(), digits = 1, format = "f")
#   valueBox(
#     value = rate,
#     icon = "fa-area-chart",
#     color = if (rate >= input$rateThreshold) "warning" else "primary"
#   )
# })
```

### Projected +3 Year Prison Population

```{r}

proj3YrPop <- 8000

renderValueBox({
  valueBox(
    value = format(proj3YrPop, nsmall=0, big.mark=","),
    icon = "fa-chart-bar",
    color = if(proj3YrPop > currPop) "warning" else "primary"
  )
})

```

### Projected +10 Year Prison Population

```{r}

proj10YrPop <- 12000

renderValueBox({
  valueBox(
    value = format(proj10YrPop, nsmall=0, big.mark=","),
    icon = "fa-chart-bar",
    color = if(proj10YrPop > currPop) "warning" else "primary"
  )
})

```

Column {data-width=350}
-----------------------------------------------------------------------

### 


```{r}
filterOffenseType <- reactive(input$offenseType)
filterPopAdjust <- reactive(input$popAdjustPct)

renderPlotly({

  fig <- monthly_prison_pop %>%
    filter(index > "2012-01-01") %>%
    filter(offesnse_category %in% filterOffenseType()) %>%
    arrange(index) %>%
    plot_ly(x = ~index, y = ~ count, type = "scatter", mode='lines', hoverinfo = "x+y") %>%
    layout(xaxis = list(title = "Date"), 
           yaxis = list(title = "Count of Incarcerated Individuals", rangemode = "tozero")
           ,title = "All Data Predictions - Aggravated Misdemeanor - Other")
  
  fig <- fig %>% add_trace(y = ~hi.95, mode = 'lines') 
  fig <- fig %>% add_trace(y = ~lo.95, mode = 'lines')
    
  fig

})

```

About {data-icon="ion-information-circled"}
=====================================

***

### About the Project

This interactive application uses publicly available data from [https://data.iowa.gov/](https://data.iowa.gov/) to forecast Iowa Prison Populations.  

Contributors:  
William Ebert, Greyson Henderson, Shivani Kharbanda, Kristi Rasmussen, Grant Ruedy, Husam Yassin

All source code can be found [here](https://github.com/kristirasmussen/iowa-prison-pop-forecasting) on GitHub.

*Note: This project was completed for the Georgia Tech Data & Visual Analytics Fall 2021 course.*
